public with sharing class BooksDataController {
    @AuraEnabled(cacheable = true)
    public static String callBooks(String query, String authorFilter, String publisherFilter, Integer startIndex, Integer maxResults) {
        authorFilter = authorFilter.trim();
        publisherFilter = publisherFilter.trim();
        String q = query 
            + (String.isNotBlank(authorFilter) ? '+inauthor:' + authorFilter : '') 
            + (String.isNotBlank(publisherFilter) ? '+inpublisher:' + publisherFilter : '');
        String endpoint = 'https://www.googleapis.com/books/v1/volumes?q=' 
                            + EncodingUtil.urlEncode(q, 'UTF-8')
                            + '&maxResults=' + maxResults
                            + '&startIndex=' + startIndex;
        Http http = new Http();
        HttpRequest request = new HttpRequest();
        request.setEndpoint(endpoint);
        request.setMethod('GET');
        HttpResponse response = http.send(request);
        
        // VolumesData volumes = (VolumesData) JSON.deserialize(response.getBody(), VolumesData.class);
        return response.getBody();
    }

    @AuraEnabled(cacheable = false)
    public static Boolean titleExists(String title, String authors) {
        List<Title__c> results = [
            SELECT Name
            FROM Title__c
            WHERE Name = :title AND Author__c = :authors
            WITH SECURITY_ENFORCED
        ];
        return results.size() > 0;
    }

    @AuraEnabled(cacheable = true)
    public static String getPublisherId(String name) {
        List<Publisher__c> results = [
            SELECT Name
            FROM Publisher__c
            WHERE Name = :name
            WITH SECURITY_ENFORCED
        ];
        if(results.isEmpty()) {
            return null;
        }
        return results[0].id;
    }

    //
    // Generated by JSON2Apex http://json2apex.herokuapp.com/
    //
    /*
    public static class VolumesData {
 
        public static class VolumeInfo_U {
            @AuraEnabled public String title;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class VolumeInfo_V {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public Double averageRating;
            @AuraEnabled public Integer ratingsCount;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class VolumeInfo_S {
            @AuraEnabled public String title;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class PanelizationSummary {
            @AuraEnabled public Boolean containsEpubBubbles;
            @AuraEnabled public Boolean containsImageBubbles;
        }

        public static class VolumeInfo_T {
            @AuraEnabled public String title;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public Integer averageRating;
            @AuraEnabled public Integer ratingsCount;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        @AuraEnabled public String kind;
        @AuraEnabled public Integer totalItems;
        @AuraEnabled public List<Items> items;

        public static class ReadingModes {
            @AuraEnabled public Boolean text;
            @AuraEnabled public Boolean image;
        }

        public static class VolumeInfo {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public Integer averageRating;
            @AuraEnabled public Integer ratingsCount;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class ListPrice {
            @AuraEnabled public Double amount;
            @AuraEnabled public String currencyCode;
        }

        public static class SaleInfo {
            @AuraEnabled public String country;
            @AuraEnabled public String saleability;
            @AuraEnabled public Boolean isEbook;
        }

        public static class Items {
            @AuraEnabled public String kind;
            @AuraEnabled public String id;
            @AuraEnabled public String etag;
            @AuraEnabled public String selfLink;
            @AuraEnabled public VolumeInfo volumeInfo;
            @AuraEnabled public SaleInfo saleInfo;
            @AuraEnabled public AccessInfo accessInfo;
            @AuraEnabled public SearchInfo searchInfo;
        }

        public static class SearchInfo {
            @AuraEnabled public String textSnippet;
        }

        public static class AccessInfo {
            @AuraEnabled public String country;
            @AuraEnabled public String viewability;
            @AuraEnabled public Boolean embeddable;
            @AuraEnabled public Boolean publicDomain;
            @AuraEnabled public String textToSpeechPermission;
            @AuraEnabled public Epub epub;
            @AuraEnabled public Epub pdf;
            @AuraEnabled public String webReaderLink;
            @AuraEnabled public String accessViewStatus;
            @AuraEnabled public Boolean quoteSharingAllowed;
        }

        public static class Offers {
            @AuraEnabled public Integer finskyOfferType;
            @AuraEnabled public ListPrice_Z listPrice;
            @AuraEnabled public ListPrice_Z retailPrice;
        }

        public static class IndustryIdentifiers {
            @AuraEnabled public String type;
            @AuraEnabled public String identifier;
        }

        public static class Epub_Z {
            @AuraEnabled public Boolean isAvailable;
            @AuraEnabled public String acsTokenLink;
        }

        public static class SaleInfo_Z {
            @AuraEnabled public String country;
            @AuraEnabled public String saleability;
            @AuraEnabled public Boolean isEbook;
            @AuraEnabled public ListPrice listPrice;
            @AuraEnabled public ListPrice retailPrice;
            @AuraEnabled public String buyLink;
            @AuraEnabled public List<Offers> offers;
        }

        public static class Epub {
            @AuraEnabled public Boolean isAvailable;
        }

        public static class AccessInfo_Y {
            @AuraEnabled public String country;
            @AuraEnabled public String viewability;
            @AuraEnabled public Boolean embeddable;
            @AuraEnabled public Boolean publicDomain;
            @AuraEnabled public String textToSpeechPermission;
            @AuraEnabled public Epub_Z epub;
            @AuraEnabled public Epub pdf;
            @AuraEnabled public String webReaderLink;
            @AuraEnabled public String accessViewStatus;
            @AuraEnabled public Boolean quoteSharingAllowed;
        }

        public static class AccessInfo_Z {
            @AuraEnabled public String country;
            @AuraEnabled public String viewability;
            @AuraEnabled public Boolean embeddable;
            @AuraEnabled public Boolean publicDomain;
            @AuraEnabled public String textToSpeechPermission;
            @AuraEnabled public Epub_Z epub;
            @AuraEnabled public Epub_Z pdf;
            @AuraEnabled public String webReaderLink;
            @AuraEnabled public String accessViewStatus;
            @AuraEnabled public Boolean quoteSharingAllowed;
        }

        public static class ImageLinks {
            @AuraEnabled public String smallThumbnail;
            @AuraEnabled public String thumbnail;
        }

        public static class VolumeInfo_Y {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class VolumeInfo_Z {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public Integer averageRating;
            @AuraEnabled public Integer ratingsCount;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class ListPrice_Z {
            @AuraEnabled public Integer amountInMicros;
            @AuraEnabled public String currencyCode;
        }

        public static class VolumeInfo_W {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publisher;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public Double averageRating;
            @AuraEnabled public Integer ratingsCount;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }

        public static class VolumeInfo_X {
            @AuraEnabled public String title;
            @AuraEnabled public String subtitle;
            @AuraEnabled public List<String> authors;
            @AuraEnabled public String publishedDate;
            @AuraEnabled public String description;
            @AuraEnabled public List<IndustryIdentifiers> industryIdentifiers;
            @AuraEnabled public ReadingModes readingModes;
            @AuraEnabled public Integer pageCount;
            @AuraEnabled public String printType;
            @AuraEnabled public List<String> categories;
            @AuraEnabled public String maturityRating;
            @AuraEnabled public Boolean allowAnonLogging;
            @AuraEnabled public String contentVersion;
            @AuraEnabled public PanelizationSummary panelizationSummary;
            @AuraEnabled public ImageLinks imageLinks;
            @AuraEnabled public String language;
            @AuraEnabled public String previewLink;
            @AuraEnabled public String infoLink;
            @AuraEnabled public String canonicalVolumeLink;
        }
    }
    */
}
